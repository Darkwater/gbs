#!/usr/bin/env ruby

require 'gbs/project_manager'
require 'gbs/project'
require 'gbs/userdata'

OPTIONS = [
    %w( -h --help       Print this help and exit ),
    %w( -v --version    Print version and exit   ),
    %w( -l --list       List available projects  ),
]
.map do |opt|
    {
        short: opt[0],
        long:  opt[1],
        desc:  opt[2..-1].join(' '),
        id:    opt[1][2..-1].to_sym # long opt without dashes
    }
end

options = {}
parameters = ARGV.reject { |arg| arg[0] == '-' }

# Parse arguments
ARGV.select { |arg| arg[0] == '-' }.each do |arg|
    opt = OPTIONS.find { |opt| opt[:short] == arg || opt[:long] == arg }
    if opt.nil?
        puts "Unknown option: #{arg}"
        exit 1
    end
    options[opt[:id]] = true
end


if options[:version]
    puts "gbs-run v0.1.0"
    exit
end

if options[:help]
    puts "Usage: #{$0} [options]"
    puts
    OPTIONS.each do |opt|
        puts '  %-2s  %-12s  %s' % [ opt[:short], opt[:long], opt[:desc] ]
    end
    exit
end


module GBS
    ProjectManager.init

    ProjectManager.projects.each do |project|
        puts project.name
    end
end
